---
title: "analyze_jaffal_simdata_accuracy"
author: "bhaas"
date: '2023-12-05'
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```



```{r}

strict_results = read.table("data/strict.combined_results.ROC.tsv", header=T, sep="\t", stringsAsFactors = F)
strict_results$analysisType="strict"

allow_reverse_results = read.table("data/allow_reverse.combined_results.ROC.tsv", header=T, sep="\t", stringsAsFactors = F)
allow_reverse_results$analysisType="allow_reverse"


```

```{r}

data = bind_rows(strict_results,
                 allow_reverse_results)


```





```{r}

data = data %>% filter(prog %in% c(
                                   'pbfusion_v0.3.1',
                                   'pbfusion_v0.4.0',
                                   'fusionseeker_s1',
                                   'LongGF',
                                   'JAFFAL',
                                   'ctat-LR-fusion.v0.12.0')
                       )


```


```{r}

data$analysisType = factor(data$analysisType, levels=c('strict', 'allow_reverse'))

data %>% 
    mutate(analysis_seqtype = paste(analysisType, seqtype)) %>%
    ggplot(aes(x=TPR, y=PPV)) + geom_point(aes(groups=prog, color=prog)) +
    facet_grid(vars(analysis_seqtype), vars(divergence))



```


```{r}



data %>% 
    filter(analysisType == "allow_reverse") %>% 
    filter(prog != "pbfusion_v0.4.0") %>%
    mutate(analysis_seqtype = paste(analysisType, seqtype)) %>%
    ggplot(aes(x=TPR, y=PPV)) + 
    geom_point(aes(groups=prog, color=prog)) +
    geom_line(aes(color=prog)) +
    facet_grid(vars(analysis_seqtype), vars(divergence)) +
    ylim(0.8,1)

```







```{r}

max_F1_data = data %>% group_by(analysisType, prog, seqtype, divergence) %>% 
    arrange(desc(F1)) %>% filter(row_number() == 1) %>% ungroup()


# rank programs 

ranked_progs = max_F1_data  %>% group_by(prog) %>% summarize(mean_F1 = mean(F1)) %>% arrange(desc(mean_F1))

max_F1_data$prog = factor(max_F1_data$prog, levels=ranked_progs$prog)

max_F1_data$analysisType = factor(max_F1_data$analysisType, levels=c('strict', 'allow_reverse'))


```


```{r}

p_linepoint = max_F1_data %>% 
    filter(analysisType %in% c('strict', 'allow_reverse')) %>%
    ggplot() + 
    geom_point(aes(x=divergence, y=F1, color=prog)) +
    geom_line(aes(x=divergence, y=F1, group=prog, color=prog)) +
    facet_grid(vars(analysisType), vars(seqtype))


p_linepoint

```


```{r}

# mention the new pbfusion v0.4.0 for supp, keep rest for main fig

p_linepoint = max_F1_data %>% 
    filter(prog != "pbfusion_v0.4.0") %>% 
    filter(analysisType %in% c('strict', 'allow_reverse')) %>%
    ggplot() + 
    geom_point(aes(x=divergence, y=F1, color=prog)) +
    geom_line(aes(x=divergence, y=F1, group=prog, color=prog)) +
    facet_grid(vars(analysisType), vars(seqtype))


p_linepoint




```



```{r}

ggsave(p_linepoint, filename="jaffal_simdata_accuracy.paperfig.pdf", width=8, height=7)

```







